ä»¥ä¸‹æ˜¯ä»£ç ä¸­å­˜åœ¨çš„æ ¸å¿ƒé€»è¾‘æ¼æ´ä»¥åŠå…·ä½“çš„ä¿®å¤ä¸ä¼˜åŒ–æ–¹æ¡ˆï¼š

ğŸš¨ é—®é¢˜ 1ï¼šMod ç­›é€‰é¡¹çš„æ€§èƒ½éšæ‚£
ç°çŠ¶ä¸é—®é¢˜ï¼š
åœ¨ GetAllModSources()  ä¸­ï¼Œæ¯æ¬¡ç©å®¶ç‚¹å‡»â€œModâ€ä¸‹æ‹‰èœå•ï¼Œä»£ç éƒ½ä¼šå»éå†æ•´ä¸ª DefDatabase<ThingDef>.AllDefsï¼ˆç¯ä¸–ç•Œä¸­é€šå¸¸æœ‰å‡ ä¸‡ä¸ª Defï¼‰ã€‚è¿™åœ¨åæœŸä¼šå¯¼è‡´ç•Œé¢å¡é¡¿ã€‚
ä¼˜åŒ–æ–¹æ¡ˆï¼šåŠ å…¥é™æ€ç¼“å­˜
å› ä¸º Mod åˆ—è¡¨åœ¨æ¸¸æˆè¿è¡ŒæœŸé—´æ˜¯ä¸ä¼šå˜çš„ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ç¬¬ä¸€æ¬¡æ‰“å¼€æ—¶è®¡ç®—ä¸€æ¬¡å³å¯ã€‚

C#
// åœ¨ FactionGearEditor ç±»ä¸­å¢åŠ ç¼“å­˜å˜é‡
private static List<string> cachedModSources = null;

private static List<string> GetAllModSources()
{
    if (cachedModSources == null)
    {
        var modSources = new HashSet<string> { "All" };
        // åªéå†æ­¦å™¨å’Œè¡£æœï¼Œå‡å°‘å¾ªç¯é‡
        foreach (var thingDef in DefDatabase<ThingDef>.AllDefs.Where(t => t.IsWeapon || t.IsApparel))
        {
            if (thingDef.modContentPack != null)
            {
                modSources.Add(FactionGearManager.GetModGroup(thingDef));
            }
        }
        cachedModSources = modSources.OrderBy(s => s).ToList();
    }
    return cachedModSources;
}
ğŸš¨ é—®é¢˜ 2ï¼šæ˜¯å¦æ­£ç¡®è¯»å–äº† Faction æ­¦è£…ï¼Ÿï¼ˆå®Œå…¨é”™è¯¯ï¼ï¼‰
ç°çŠ¶ä¸é—®é¢˜ï¼šè‡´å‘½é€»è¾‘æ¼æ´
ä½ è¯»å–äº†æ­¦å™¨ kindDef.weaponTags ï¼Œè¿™éƒ¨åˆ†æ˜¯å¯¹çš„ã€‚ä½†æ˜¯å¯¹äºæœè£…ï¼Œä½ è°ƒç”¨äº† LoadDefaultApparel(kindData) ã€‚
åœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œä½ ä½¿ç”¨äº† GetAllArmors().Take(5) å’Œ GetAllApparel().Take(5) ã€‚
è¿™æ„å‘³ç€ï¼šä½ çš„ä»£ç æ ¹æœ¬æ²¡æœ‰å»è¯»åŸç‰ˆå…µç§è¯¥ç©¿ä»€ä¹ˆï¼å®ƒç®€å•ç²—æš´åœ°æŠŠæ¸¸æˆæ•°æ®åº“é‡Œçš„å‰5ä»¶è¡£æœå¼ºè¡Œå¡ç»™äº†æ‰€æœ‰å…µç§ï¼ å¯¼è‡´éƒ¨è½å…µå¯èƒ½è¯»å–åˆ°æ˜Ÿé™…æˆ˜å£«çš„åŠ¨åŠ›ç”²ã€‚
+3

ä¿®å¤æ–¹æ¡ˆï¼šé€šè¿‡ apparelTags æ­£ç¡®è¯»å–åŸç‰ˆæ­¦è£…
ä½ éœ€è¦å½»åº•åºŸå¼ƒ LoadDefaultApparel æ–¹æ³•ï¼Œä¿®æ”¹ LoadKindDefGear å¦‚ä¸‹ï¼š

C#
public static void LoadKindDefGear(PawnKindDef kindDef, KindGearData kindData)
{
    // 1. è¯»å–åŸç‰ˆæ­¦å™¨æ ‡ç­¾
    if (kindDef.weaponTags != null)
    {
        var weapons = DefDatabase<ThingDef>.AllDefs.Where(t => t.IsWeapon && t.weaponTags != null && t.weaponTags.Intersect(kindDef.weaponTags).Any()).ToList();
        foreach (var weapon in weapons)
        {
            if (weapon.IsRangedWeapon && !kindData.weapons.Any(g => g.thingDefName == weapon.defName))
                kindData.weapons.Add(new GearItem(weapon.defName));
            else if (weapon.IsMeleeWeapon && !kindData.meleeWeapons.Any(g => g.thingDefName == weapon.defName))
                kindData.meleeWeapons.Add(new GearItem(weapon.defName));
        }
    }

    // 2. ã€æ ¸å¿ƒä¿®å¤ã€‘è¯»å–åŸç‰ˆæœè£…æ ‡ç­¾ (apparelTags)
    if (kindDef.apparelTags != null)
    {
        var apparels = DefDatabase<ThingDef>.AllDefs.Where(t => t.IsApparel && t.apparel.tags != null && t.apparel.tags.Intersect(kindDef.apparelTags).Any()).ToList();
        foreach (var app in apparels)
        {
            if (app.apparel.layers != null)
            {
                if (app.apparel.layers.Contains(ApparelLayerDefOf.Shell) || app.GetStatValueAbstract(StatDefOf.ArmorRating_Sharp) > 0.4f)
                {
                    if (!kindData.armors.Any(g => g.thingDefName == app.defName)) kindData.armors.Add(new GearItem(app.defName));
                }
                else if (app.apparel.layers.Contains(ApparelLayerDefOf.Belt))
                {
                    if (!kindData.others.Any(g => g.thingDefName == app.defName)) kindData.others.Add(new GearItem(app.defName));
                }
                else
                {
                    if (!kindData.apparel.Any(g => g.thingDefName == app.defName)) kindData.apparel.Add(new GearItem(app.defName));
                }
            }
        }
    }
}
ğŸš¨ é—®é¢˜ 3 & 4ï¼šä¿å­˜åŠŸèƒ½ä¸æ˜ç¡®ä¸é¢„è®¾é‡å¤ä¿å­˜
ç°çŠ¶ä¸é—®é¢˜ï¼š


ä¸»ç•Œé¢çš„ "Save"ï¼šä¿å­˜å½“å‰æ¸¸æˆç”Ÿæ•ˆçš„è®¾ç½® ã€‚


é¢„è®¾ç•Œé¢çš„ "Update Info"ï¼šåªä¿å­˜åå­—å’Œæè¿°ï¼Œä¸ä¿å­˜è£…å¤‡ ã€‚
+1


é¢„è®¾ç•Œé¢çš„ "Overwrite Preset With Current Gear"ï¼šæŠŠä¸»ç•Œé¢çš„è£…å¤‡è¦†ç›–åˆ°å½“å‰é¢„è®¾é‡Œ ã€‚
è¿™è®©ç©å®¶æåº¦å›°æƒ‘ã€‚è€Œä¸”åœ¨æ–°å»ºé¢„è®¾æ—¶ ï¼Œå¦‚æœç©å®¶è¿ç‚¹ä¸¤æ¬¡ "Create"ï¼Œæˆ–è€…åå­—é‡å¤ï¼Œæ²¡æœ‰ä»»ä½•é”™è¯¯æç¤ºã€‚
+2

ä¿®å¤æ–¹æ¡ˆï¼šæ–‡æœ¬ä¸é€»è¾‘çš„QoLæ”¹å–„

å°†ä¸»ç•Œé¢çš„ Save æ”¹åä¸º Apply & Save to Game (åº”ç”¨å¹¶ä¿å­˜è‡³å½“å‰æ¸¸æˆ)ã€‚

åœ¨ CreateNewPreset ä¸­åŠ å…¥æŸ¥é‡å’Œè¦†ç›–æç¤ºã€‚

ğŸš¨ é—®é¢˜ 5ï¼šé¢„è®¾ä¸­ UI å¸ƒå±€ä¸åˆç†ï¼Œæç¤ºä¸æ¸…æ™°
ç°çŠ¶ä¸é—®é¢˜ï¼šåäººç±»çš„ UX è®¾è®¡
åœ¨ DrawPresetDetails ä¸­ï¼Œä½ æŠŠ â€œæ–°å»ºé¢„è®¾ (Create New Preset)â€  çš„è¾“å…¥æ¡†æ”¾åœ¨äº†å³ä¾§çš„â€œé¢„è®¾è¯¦æƒ…â€é¢æ¿æœ€é¡¶éƒ¨ã€‚
æ­£å¸¸çš„é€»è¾‘æ˜¯ï¼šå·¦è¾¹æ˜¯åˆ—è¡¨ï¼ˆè´Ÿè´£æ–°å»ºã€åˆ é™¤ã€é€‰æ‹©ï¼‰ï¼Œå³è¾¹æ˜¯è¯¦æƒ…ï¼ˆè´Ÿè´£å±•ç¤ºå’Œä¿®æ”¹è¢«é€‰ä¸­çš„æ•°æ®ï¼‰ã€‚æ­¤å¤–ï¼Œä½ å¯¹ DrawFactionPreview å’Œ DrawModList å¼ºè¡ŒåŠ äº†å›ºå®šçš„ y += 160f å’Œ y += 110f ï¼Œå¯¼è‡´æ’ç‰ˆä¼šæœ‰å¤§ç‰‡ç©ºç™½æˆ–å†…å®¹é‡å ã€‚
+4

ä¿®å¤æ–¹æ¡ˆï¼šUI ç»“æ„å¤§é‡æ„

å°†â€œæ–°å»ºé¢„è®¾â€ç§»åˆ°å·¦ä¾§åˆ—è¡¨é¢æ¿çš„åº•éƒ¨ã€‚

å³ä¾§é¢æ¿çº¯ç²¹ä½œä¸ºè¯¦æƒ…å±•ç¤ºåŒºï¼Œå¹¶ä½¿ç”¨ Listing_Standard è‡ªåŠ¨è®¡ç®—é«˜åº¦ã€‚

å»ºè®®å¯¹ PresetManagerWindow ä¸­çš„æ’ç‰ˆä»£ç è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ï¼š

C#
// 1. ä¿®æ”¹ DrawPresetList (å·¦ä¾§åˆ—è¡¨)
private void DrawPresetList(Rect rect)
{
    Widgets.DrawMenuSection(rect);
    Rect innerRect = rect.ContractedBy(5f);
    
    // åˆ—è¡¨åŒºåŸŸåªå ä¸Šæ–¹ 80%
    Rect listOutRect = new Rect(innerRect.x, innerRect.y + 55f, innerRect.width, innerRect.height - 150f);
    // ... ä¸­é—´ç»˜åˆ¶åˆ—è¡¨ä»£ç ä¿æŒä¸å˜ ...

    // ã€æ–°å¢ã€‘å°†æ–°å»ºé¢„è®¾ç§»åˆ°å·¦ä¾§åº•éƒ¨
    float bottomY = innerRect.yMax - 85f;
    Widgets.DrawLineHorizontal(innerRect.x, bottomY, innerRect.width);
    Widgets.Label(new Rect(innerRect.x, bottomY + 5f, innerRect.width, 24f), "Create New:");
    newPresetName = Widgets.TextField(new Rect(innerRect.x, bottomY + 30f, innerRect.width - 70f, 24f), newPresetName);
    
    if (Widgets.ButtonText(new Rect(innerRect.xMax - 65f, bottomY + 30f, 65f, 24f), "Add"))
    {
        CreateNewPreset();
    }
}

// 2. ä¿®æ”¹ DrawPresetDetails (å³ä¾§è¯¦æƒ…)
private void DrawPresetDetails(Rect rect)
{
    Widgets.DrawMenuSection(rect);
    if (selectedPreset == null)
    {
        Text.Anchor = TextAnchor.MiddleCenter;
        Widgets.Label(rect, "Please select a preset from the left list.");
        Text.Anchor = TextAnchor.UpperLeft;
        return;
    }

    Rect innerRect = rect.ContractedBy(10f);
    Listing_Standard listing = new Listing_Standard();
    listing.Begin(innerRect);

    listing.Label("Preset Details:");
    selectedPreset.name = listing.TextEntry(selectedPreset.name);
    selectedPreset.description = listing.TextEntry(selectedPreset.description, 2);
    
    // æŠŠé‚£ä¸¤ä¸ªå®¹æ˜“æ··æ·†çš„æŒ‰é’®åç§°æ”¹æ‰
    if (listing.ButtonText("1. Save Meta Info (Name/Desc)")) SavePreset();
    listing.Gap(10f);
    
    GUI.color = Color.cyan;
    if (listing.ButtonText("2. Overwrite Preset With Current Active Gear")) SaveFromCurrentSettings();
    GUI.color = Color.white;
    listing.GapLine();

    // è‡ªåŠ¨è®¡ç®—é«˜åº¦ï¼Œä¸å†ç¡¬ç¼–ç  y += 160f
    listing.Label("Required Mods:");
    // è¿™é‡Œè°ƒç”¨ä½ åŸæœ¬ç”»Modçš„æ–¹æ³•ï¼Œä½†é«˜åº¦æ”¹å°ç‚¹
    DrawModList(listing.GetRect(80f)); 
    listing.Gap(10f);

    listing.Label("Faction Preview:");
    DrawFactionPreview(listing.GetRect(200f)); 
    
    listing.GapLine();
    // å±é™©æ“ä½œæ”¾æœ€åº•ä¸‹
    Rect dangerRect = listing.GetRect(30f);
    if (Widgets.ButtonText(new Rect(dangerRect.x, dangerRect.y, 100f, 30f), "Load/Apply")) ApplyPreset();
    if (Widgets.ButtonText(new Rect(dangerRect.x + 110f, dangerRect.y, 100f, 30f), "Export to Clipboard")) ExportPreset();
    
    GUI.color = Color.red;
    if (Widgets.ButtonText(new Rect(dangerRect.xMax - 100f, dangerRect.y, 100f, 30f), "Delete Preset")) DeletePreset();
    GUI.color = Color.white;

    listing.End();
}
æ€»ç»“
ä½ çš„å¯¼å‡ºå¯¼å…¥é€»è¾‘ï¼ˆBase64åºåˆ—åŒ– ï¼‰å†™å¾—å¾ˆæ¼‚äº®ï¼Œæ˜¯å¾ˆè§„èŒƒçš„ RimWorld Mod å†™æ³•ã€‚
+1

æ ¸å¿ƒç—›ç‚¹åœ¨äº LoadDefaultApparel å½»åº•æ‘§æ¯äº†åŸç‰ˆçš„æ´¾ç³»æ­¦è£…ç”Ÿæ€ï¼Œè¯·åŠ¡å¿…ä½¿ç”¨æˆ‘æä¾›çš„ kindDef.apparelTags è¯»å–ä»£ç æ›¿æ¢å®ƒã€‚

UIä¸Šï¼ŒæŠŠæ–°å»ºåŠŸèƒ½ç§»å‡ºè¯¦æƒ…é¡µï¼Œç«‹åˆ»èƒ½è®©ç©å®¶çš„æ“ä½œå¿ƒæ™ºæ¨¡å‹é¡ºç•…10å€ã€‚